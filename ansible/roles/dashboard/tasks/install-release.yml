---
- name: Create directory for Dashboard web application
  file: path='{{ dashboard_path }}' state=directory mode=2755

- name: Download release
  get_url:
    url: https://github.com/City-of-Bloomington/dashboard/releases/download/{{ dashboard_version }}/dashboard-{{ dashboard_version }}.tar.gz
    dest: "{{ dashboard_install_dir }}/dashboard-{{ dashboard_version }}.tar.gz"
  register: release

- name: Extract release
  command: tar xzvf dashboard-{{ dashboard_version }}.tar.gz
  args:
    chdir: "{{ dashboard_install_dir }}"
  when: release.changed

- name: Install release
  command: rsync -rlv {{ dashboard_install_dir }}/dashboard-{{ dashboard_version }}/ {{ dashboard_path }}/
  notify: dashboard update permissions
  when: release.changed

- name: Configure application instance
  template: src=site_config.inc dest={{ dashboard_path }}/data/
  notify: dashboard update permissions

- name: Configure COB Theme
  template: src=theme_config.inc dest={{ dashboard_path }}/data/Themes/COB
  notify: dashboard update permissions
